---
title: 异步消息笔记
date: 2017-07-10 18:48:31
tags:
- 异步消息
- Spring
categories:
- 技术向
thumbnail: http://cdn.happylrd.com/image/shaosiming_4.jpg
---

> 昨夜西风凋碧树，独上高楼，望尽天涯路。欲寄彩笺兼尺素，山长水阔知何处？
> <div style="text-align:right"><p>——《<cite>蝶恋花·槛菊愁烟兰泣露</cite>》</p></div>

## 引子

> etc...

## 简介

### 是什么

异步消息 是一个应用程序向另一个应用程序 **间接** 发送消息的一种方式，这种方式无需等待对方的响应。

异步消息中的两个重要的概念
- 消息代理（message broker）
- 目的地（destination）

当一个应用发送消息时，会将消息交给一个消息代理。消息代理可以确保消息被投递到指定的目的地，同时解放发送者，使其能够继续进行其他的业务。

每条异步消息都带有一个目的地，目的地 **只关注消息应该从哪里获得，而不关心消息被谁取走**。

尽管不同的消息系统会提供不同的消息路由模式，但是有两种通用的目的地：队列（queue）和主题（topic）。每种类型都与特定的消息模型相关联，分别是 *点对点模型（队列）和 发布/订阅模型（主题）*。

#### 点对点消息模型

在 点对点模型 中，每一条消息都有一个发送者和一个接收者。当消息代理得到消息时，它将消息放入一个队列中。当接收者请求队列中的下一条消息时，消息会从队列中取出，并投递给接收者。因为消息投递后会从队列中删除，这样就可以保证消息只能投递给一个接收者，即 **虽然队列可以有多个接收者，但是每一条消息只能被一个接收者取走**。

消息队列对消息发送者和消息接收者进行了解耦。

在点对点的消息中，如果有多个接收者监听队列，我们就 **无法知道某条特定的消息会由哪一个接收者处理**。这种 *不确定性* 实际上有很多好处，因为我们只需要简单地为队列添加新的监听器就能提高应用的消息处理能力。

#### 发布/订阅消息模型

在 发布/订阅模型 中，消息会发送给一个主题。与队列类似，多个接收者都可以监听一个主题。与队列不同的是，消息不再是只投递给一个接收者，而是主题的所有订阅者都会接收到此消息的副本，即 **主题消息可以发送给多个主题订阅者**。

主题对消息发送者和消息接收者进行了解耦。

对于异步消息而言，发布者并不知道谁订阅了它的消息。发布者只知道它的消息要发送到一个特定的主题，而不知道有谁在监听这个主题。也就是说，**发布者并不知道消息是如何被处理的**。

### 为什么

同步通信的限制
- 等待。当客户端调用远程服务的方法时，它必须等待远程方法结束后才能继续执行。如果客户端与远程服务频繁通信，或者远程服务响应很慢，就会对客户端应用的性能带来负面影响。


- 客户端通过服务接口与远程服务相耦合。如果服务的接口发生变化，此服务的所有客户端都需要做相应的改变。


- 客户端与远程服务的位置耦合。客户端必须配置服务的网络位置，这样它才知道如何与远程服务进行交互。如果网络拓扑进行调整，客户端也需要重新配置新的网络位置。


- 客户端与服务的可用性相耦合。如果远程服务不可用，客户端实际上也无法正常运行。

异步通信的好处
- 无需等待
- 面向消息和解耦
- 位置独立
- 确保投递

（未完待续...）
