---
title: 初遇微服务
date: 2017-07-01 15:05:48
tags:
- Microservices
- 软件架构
- 分布式系统
categories:
- 技术向
thumbnail: http://cdn.happylrd.com/image/microservices.jpg
---

> 若言琴上有琴声，放在匣中何不鸣？若言声在指头上，何不于君指上听？
> <div style="text-align:right"><p>——《<cite>琴诗</cite>》</p></div>

## 引子

> 随着 **领域驱动设计、持续交付、按需虚拟化、基础设施自动化、小型自治团队、大型集群系统** 这些实践的流行，微服务也应运而生。

微服务（[Microservices](https://martinfowler.com/articles/microservices.html)）是一种 **分布式系统解决方案**，推动细粒度服务的使用，这些服务协同工作，且每个服务都有自己的生命周期。

因为微服务主要围绕业务领域建模，所以避免了由传统的分层架构引发的很多问题。

微服务架构 之于 SOA（Service-Oriented Architecture，面向服务的架构）就像 XP（Extreme Programming，极限编程）或 Scrum 之于 敏捷软件开发。微服务整合了过去十年来的新概念和技术，因此得以避开许多 SOA 中的陷阱。

## 简介

### 是什么

微服务就是一些 **协同工作的小而自治的服务**。

#### 小而美

内聚性
- 单一职责原则：把因 相同原因而变化的东西 聚合到一起，而把因 不同原因而变化的东西 分离开来。

微服务将这个理念应用在独立的服务上，根据业务的边界来确定服务的边界。这样就很容易确定某个功能代码应该放在哪里，而且由于该服务专注于某个边界之内，因此可以很好地避免由于代码库过大而衍生出的很多相关问题。

> 如何控制代码库大小？

代码库 **足够小即可，不要过小**。
服务越小，独立性带来的好处就越多，但与此同时，管理大量服务所带来的复杂性也会越高。

#### 自治性

一个微服务就是一个独立的实体。它可以独立地部署在 PAAS（Platform As A Service，平台即服务）上，也可以作为一个 OS进程 存在。

我们要尽量 避免把多个服务部署到同一台机器上。尽管这种隔离性会引发一些代价，但它能够大大简化分布式系统的构建，而且有很多新技术可以帮助解决这种部署模型带来的问题。

服务之间均通过 **网络调用** 进行通信，从而加强了服务之间的隔离性，避免紧耦合。

这些服务应该可以彼此间独立进行修改，并且某一个服务的部署不应该引起该服务消费方的变动。对于一个服务来说，我们需要考虑的是 *什么应该暴露，什么应该隐藏*。如果暴露得过多，那么服务消费方会与该服务的内部实现产生耦合，这会使得服务和消费方之间产生额外的协调工作，从而降低服务的自治性。

服务会暴露出 API，然后服务之间通过这些 API 进行通信。API 的实现技术应该避免与消费方耦合，这就意味着应该 **选择与具体技术不相关的 API 实现方式**，以保证技术的选择不被限制。

为了达到解耦的目的，需要正确地建模服务和 API。

### 为什么

微服务有很多不同的好处，其中很多好处也适用于任何一个分布式系统。但相对于 分布式系统 或者 SOA 而言，微服务要更胜一筹，它会把这些好处推向极致。

主要好处
- **技术异构性**：在一个由多个服务相互协作的系统中，可以 **在不同的服务中使用最适合该服务的技术**。尝试使用一种适合所有场景的标准化技术，会使得所有的场景都无法得到很好的支持。微服务可以帮助我们更快地采用新技术，并且理解这些新技术的好处。尝试新技术通常伴随着风险，这使得很多人望而却步。尤其是对于单块系统而言，采用一个新的语言、数据库或者框架都会对整个系统产生巨大的影响。对于微服务系统而言，总会存在一些地方让我们可以尝试新技术。你可以选择一个风险最小的服务来采用新技术，即便出现问题也容易处理。这种可以快速采用新技术的能力对很多人而言是非常有价值的。


- **弹性**：在单块系统中，如果服务不可用，那么所有相关的功能都会不可用。对于单块服务的系统而言，可以通过将同样的实例运行在不同的机器上来降低功能完全不可用的概率，然而微服务系统本身就能够 **很好地处理服务不可用和功能降级** 问题。


- **可扩展性**：庞大的单块服务只能作为一个整体进行扩展，即使系统中只有一小部分存在性能问题，也需要对整个服务进行扩展。如果使用较小的多个服务，则可以 **只对需要扩展的服务进行扩展**，这样就可以把那些不需要扩展的服务运行在更小的、性能稍差的硬件上。


- **简化部署**：在微服务架构中，**各个服务的部署是独立的**，这样就可以更快地对特定部分的代码进行部署。如果真的出了问题，也只会影响一个服务，并且容易快速回滚，这也意味着客户可以更快地使用我们开发的新功能。


- **与组织结构相匹配**：微服务架构可以很好地将架构与组织结构相匹配，避免出现过大的代码库，从而获得理想的团队大小及生产力。服务的所有权也可以在团队之间迁移，从而避免异地团队的出现。


- **可组合性**：在微服务架构中，根据不同的目的，人们可以通过不同的方式使用同一个功能，在考虑客户如何使用该软件时这一点尤其重要。单纯考虑桌面网站或者移动APP的时代已经过去了，现在我们需要考虑的应用程序种类包括 Web、移动端 Web、原生应用、平板应用、可穿戴设备等，针对每一种都应该考虑如何对已有功能进行组合来实现这些应用。在微服务架构中，系统会开放很多接口供外部使用。当情况发生改变时，可以使用不同的方式构建应用。


- **可替代性**：微服务中的多个服务大小相似，所以重写或移除一个或者多个服务的阻碍也很小。

### 其他分解技术

- 共享库
- 模块

（未完待续...）
